{% extends "base.html" %}

{% block top_hero %}
<div class="top-hero">
  <div class="hero-left">
    <h1>Good {{ "evening" if true else "day" }}, {{ session.get('username') or 'Guest' }}!</h1>
    <p class="small-muted">How can we help you today? Submit a ticket or browse our knowledge base.</p>
  </div>

  <div class="d-flex align-items-center gap-3">
    <a href="{{ url_for('new_ticket') }}" class="btn btn-light btn-sm">
      <i class="bi bi-plus-lg"></i> New Ticket
    </a>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="row mt-4">
  <div class="col-lg-3 col-md-6">
    <div class="card p-3 card-stats">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="small-muted">Total Tickets</div>
          <div class="h4 mt-2">{{ total }}</div>
        </div>
        <i class="bi bi-journal-check" style="font-size:28px;color:#cfe3ff"></i>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card p-3 card-stats">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="small-muted">Open</div>
          <div class="h4 mt-2">{{ open }}</div>
        </div>
        <i class="bi bi-clock-history" style="font-size:28px;color:#fff1c9"></i>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card p-3 card-stats">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="small-muted">In Progress</div>
          <div class="h4 mt-2">{{ progress }}</div>
        </div>
        <i class="bi bi-exclamation-triangle" style="font-size:28px;color:#fff4dd"></i>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div class="card p-3 card-stats">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="small-muted">Resolved</div>
          <div class="h4 mt-2">{{ resolved }}</div>
        </div>
        <i class="bi bi-check-circle" style="font-size:28px;color:#dff7e3"></i>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-lg-8">
    <div class="recent-card">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Recent Tickets</h5>
        <a href="{{ url_for('view_tickets') }}" class="small-muted">View All</a>
      </div>

      <ul class="list-group list-group-flush mt-3">
        {% for t in tickets[:6] %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ t[1] }}</strong>
            <div class="small-muted">by {{ t[6] or 'â€”' }}</div>
            <div class="mt-1">
              <span class="badge bg-light text-dark">{{ t[2] }}</span>
              <span class="badge bg-warning text-dark">{{ t[3] }}</span>
              <span class="badge bg-secondary text-white">{{ t[4] }}</span>
            </div>
          </div>

          <div>
            <a href="{{ url_for('ticket_details', ticket_id=t[0]) }}" class="btn btn-outline-primary btn-sm">View</a>
          </div>
        </li>
        {% else %}
        <li class="list-group-item">No tickets yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="quick-card">
      <h6>Quick Actions</h6>
      <div class="d-grid gap-2 mt-3">
        <a class="btn btn-outline-primary" href="{{ url_for('new_ticket') }}"><i class="bi bi-plus-lg"></i> Submit New Request</a>
        <a class="btn btn-outline-success" href="{{ url_for('view_tickets') }}"><i class="bi bi-list-check"></i> Track My Tickets</a>
        <a class="btn btn-outline-secondary" href="{{ url_for('knowledge') }}"><i class="bi bi-book"></i> Knowledge Base</a>
      </div>
    </div>

    <div class="quick-card mt-3">
      <h6>Tips</h6>
      <p class="small-muted mb-0">When reporting issues, include screen captures and error messages for faster resolution.</p>
    </div>
  </div>
</div>
{% endblock %}
